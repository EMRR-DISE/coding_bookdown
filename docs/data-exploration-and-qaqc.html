<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Data Exploration and QA/QC | Coding Bookdown for EMRR</title>
  <meta name="description" content="<p>This book provides example code for stats and working with data in R.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Data Exploration and QA/QC | Coding Bookdown for EMRR" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://emrr-dise.github.io/coding_bookdown/" />
  <meta property="og:image" content="https://emrr-dise.github.io/coding_bookdown/images/yolo-cows.jpg" />
  <meta property="og:description" content="<p>This book provides example code for stats and working with data in R.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="EMRR-DISE/coding_bookdown" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Data Exploration and QA/QC | Coding Bookdown for EMRR" />
  
  <meta name="twitter:description" content="<p>This book provides example code for stats and working with data in R.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="twitter:image" content="https://emrr-dise.github.io/coding_bookdown/images/yolo-cows.jpg" />

<meta name="author" content="Catarina Pien" />


<meta name="date" content="2022-04-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="for-loops-and-conditionals.html"/>
<link rel="next" href="basic-stats.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">EMRR Coding Bookdown</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="basics-of-r.html"><a href="basics-of-r.html"><i class="fa fa-check"></i><b>1</b> Basics of R</a></li>
<li class="chapter" data-level="2" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>2</b> Data Manipulation</a></li>
<li class="chapter" data-level="3" data-path="making-plots.html"><a href="making-plots.html"><i class="fa fa-check"></i><b>3</b> Making Plots</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="making-plots.html"><a href="making-plots.html#coding-goals"><i class="fa fa-check"></i><b>3.0.1</b> Coding goals</a></li>
<li class="chapter" data-level="3.0.2" data-path="making-plots.html"><a href="making-plots.html#study-overview"><i class="fa fa-check"></i><b>3.0.2</b> Study overview</a></li>
<li class="chapter" data-level="3.0.3" data-path="making-plots.html"><a href="making-plots.html#metadata-for-data-set"><i class="fa fa-check"></i><b>3.0.3</b> Metadata for data set</a></li>
<li class="chapter" data-level="3.0.4" data-path="making-plots.html"><a href="making-plots.html#helpful-resources"><i class="fa fa-check"></i><b>3.0.4</b> Helpful resources</a></li>
<li class="chapter" data-level="3.0.5" data-path="making-plots.html"><a href="making-plots.html#initial-set-up"><i class="fa fa-check"></i><b>3.0.5</b> Initial set up</a></li>
<li class="chapter" data-level="3.0.6" data-path="making-plots.html"><a href="making-plots.html#formatting-the-data-set-and-making-the-first-plot"><i class="fa fa-check"></i><b>3.0.6</b> Formatting the data set and making the first plot</a></li>
<li class="chapter" data-level="3.0.7" data-path="making-plots.html"><a href="making-plots.html#summarize-the-data-in-new-tibble"><i class="fa fa-check"></i><b>3.0.7</b> Summarize the data in new tibble</a></li>
<li class="chapter" data-level="3.0.8" data-path="making-plots.html"><a href="making-plots.html#plot-time-series-for-each-study-site-separately"><i class="fa fa-check"></i><b>3.0.8</b> Plot time series for each study site separately</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="interactive-tools.html"><a href="interactive-tools.html"><i class="fa fa-check"></i><b>4</b> Interactive Tools</a>
<ul>
<li class="chapter" data-level="4.1" data-path="interactive-tools.html"><a href="interactive-tools.html#plotly---interactive-plotting"><i class="fa fa-check"></i><b>4.1</b> Plotly - Interactive plotting</a></li>
<li class="chapter" data-level="4.2" data-path="interactive-tools.html"><a href="interactive-tools.html#leaflet"><i class="fa fa-check"></i><b>4.2</b> Leaflet</a></li>
<li class="chapter" data-level="4.3" data-path="interactive-tools.html"><a href="interactive-tools.html#mapview"><i class="fa fa-check"></i><b>4.3</b> Mapview</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>5</b> Shiny</a></li>
<li class="chapter" data-level="6" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html"><i class="fa fa-check"></i><b>6</b> Spatial data and making maps</a>
<ul>
<li class="chapter" data-level="6.1" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#load-data"><i class="fa fa-check"></i><b>6.1</b> Load data</a></li>
<li class="chapter" data-level="6.2" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#get-data-into-spatial-form"><i class="fa fa-check"></i><b>6.2</b> Get data into spatial form</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#spatial-projections"><i class="fa fa-check"></i><b>6.2.1</b> Spatial projections</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#basic-spatial-operations"><i class="fa fa-check"></i><b>6.3</b> Basic Spatial Operations</a></li>
<li class="chapter" data-level="6.4" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#make-maps"><i class="fa fa-check"></i><b>6.4</b> Make maps</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#basic-maps"><i class="fa fa-check"></i><b>6.4.1</b> Basic maps</a></li>
<li class="chapter" data-level="6.4.2" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#add-arrows-and-scale-bars-dotted-lines"><i class="fa fa-check"></i><b>6.4.2</b> Add arrows and scale bars, dotted lines</a></li>
<li class="chapter" data-level="6.4.3" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#add-labels-to-map"><i class="fa fa-check"></i><b>6.4.3</b> Add labels to map</a></li>
<li class="chapter" data-level="6.4.4" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#add-inset-map"><i class="fa fa-check"></i><b>6.4.4</b> Add inset map</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="spatial-data-and-making-maps.html"><a href="spatial-data-and-making-maps.html#basemaps"><i class="fa fa-check"></i><b>6.5</b> Basemaps</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>7</b> Functions</a></li>
<li class="chapter" data-level="8" data-path="for-loops-and-conditionals.html"><a href="for-loops-and-conditionals.html"><i class="fa fa-check"></i><b>8</b> For Loops and Conditionals</a>
<ul>
<li class="chapter" data-level="8.1" data-path="for-loops-and-conditionals.html"><a href="for-loops-and-conditionals.html#for-loops"><i class="fa fa-check"></i><b>8.1</b> For Loops</a></li>
<li class="chapter" data-level="8.2" data-path="for-loops-and-conditionals.html"><a href="for-loops-and-conditionals.html#conditionals"><i class="fa fa-check"></i><b>8.2</b> Conditionals</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html"><i class="fa fa-check"></i><b>9</b> Data Exploration and QA/QC</a>
<ul>
<li class="chapter" data-level="9.1" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#recommended-reference-material"><i class="fa fa-check"></i><b>9.1</b> 1 Recommended Reference Material</a></li>
<li class="chapter" data-level="9.2" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#background"><i class="fa fa-check"></i><b>9.2</b> 2 Background</a></li>
<li class="chapter" data-level="9.3" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#prepare-your-data"><i class="fa fa-check"></i><b>9.3</b> 3 Prepare your data</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#get-data"><i class="fa fa-check"></i><b>9.3.1</b> Get data</a></li>
<li class="chapter" data-level="9.3.2" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#develop-your-questions"><i class="fa fa-check"></i><b>9.3.2</b> Develop your questions</a></li>
<li class="chapter" data-level="9.3.3" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#manipulate-data"><i class="fa fa-check"></i><b>9.3.3</b> Manipulate data</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#examine-patterns-and-relationships-between-response-and-predictor"><i class="fa fa-check"></i><b>9.4</b> 4 Examine patterns and relationships between response and predictor</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#a-data-over-time"><i class="fa fa-check"></i><b>9.4.1</b> A) Data over time</a></li>
<li class="chapter" data-level="9.4.2" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#b-data-over-space"><i class="fa fa-check"></i><b>9.4.2</b> B) Data over space</a></li>
<li class="chapter" data-level="9.4.3" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#c-variability-of-data-and-continuous-categorical-relationships"><i class="fa fa-check"></i><b>9.4.3</b> C) Variability of data and continuous-categorical relationships</a></li>
<li class="chapter" data-level="9.4.4" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#d-collinearity-and-relationships-between-continuous-variables"><i class="fa fa-check"></i><b>9.4.4</b> D) Collinearity and relationships between continuous variables</a></li>
<li class="chapter" data-level="9.4.5" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#e-distribution-of-data"><i class="fa fa-check"></i><b>9.4.5</b> E) Distribution of data</a></li>
<li class="chapter" data-level="9.4.6" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#f-how-balanced-are-your-data"><i class="fa fa-check"></i><b>9.4.6</b> F) How balanced are your data?</a></li>
<li class="chapter" data-level="9.4.7" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#g-are-there-missing-data"><i class="fa fa-check"></i><b>9.4.7</b> G) Are there missing data?</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#identifying-outliers"><i class="fa fa-check"></i><b>9.5</b> 5 Identifying Outliers</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#a-tukey-outliers"><i class="fa fa-check"></i><b>9.5.1</b> A) Tukey Outliers</a></li>
<li class="chapter" data-level="9.5.2" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#b-median-absolute-deviation-outliers"><i class="fa fa-check"></i><b>9.5.2</b> B) Median Absolute Deviation Outliers</a></li>
<li class="chapter" data-level="9.5.3" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#c-run-outlier-tests"><i class="fa fa-check"></i><b>9.5.3</b> C) Run outlier tests</a></li>
<li class="chapter" data-level="9.5.4" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#d-treatment-of-outliers"><i class="fa fa-check"></i><b>9.5.4</b> D) Treatment of outliers</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#other-qaqc"><i class="fa fa-check"></i><b>9.6</b> 6 Other QA/QC</a></li>
<li class="chapter" data-level="9.7" data-path="data-exploration-and-qaqc.html"><a href="data-exploration-and-qaqc.html#references"><i class="fa fa-check"></i><b>9.7</b> 7 References</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="basic-stats.html"><a href="basic-stats.html"><i class="fa fa-check"></i><b>10</b> Basic Stats</a>
<ul>
<li class="chapter" data-level="10.1" data-path="basic-stats.html"><a href="basic-stats.html#parametric-stats"><i class="fa fa-check"></i><b>10.1</b> Parametric Stats</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="basic-stats.html"><a href="basic-stats.html#t-test"><i class="fa fa-check"></i><b>10.1.1</b> T-test</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="basic-stats.html"><a href="basic-stats.html#non-parametric-statistics"><i class="fa fa-check"></i><b>10.2</b> Non-parametric Statistics</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="glm-and-glmm.html"><a href="glm-and-glmm.html"><i class="fa fa-check"></i><b>11</b> GLM and GLMM</a></li>
<li class="chapter" data-level="12" data-path="gam-and-gamm.html"><a href="gam-and-gamm.html"><i class="fa fa-check"></i><b>12</b> GAM and GAMM</a></li>
<li class="chapter" data-level="13" data-path="multivariate-stats.html"><a href="multivariate-stats.html"><i class="fa fa-check"></i><b>13</b> Multivariate Stats</a>
<ul>
<li class="chapter" data-level="13.1" data-path="multivariate-stats.html"><a href="multivariate-stats.html#load-data-1"><i class="fa fa-check"></i><b>13.1</b> Load data</a></li>
<li class="chapter" data-level="13.2" data-path="multivariate-stats.html"><a href="multivariate-stats.html#pca"><i class="fa fa-check"></i><b>13.2</b> PCA</a></li>
<li class="chapter" data-level="13.3" data-path="multivariate-stats.html"><a href="multivariate-stats.html#cluster-analysis"><i class="fa fa-check"></i><b>13.3</b> Cluster analysis</a></li>
<li class="chapter" data-level="13.4" data-path="multivariate-stats.html"><a href="multivariate-stats.html#nmds"><i class="fa fa-check"></i><b>13.4</b> NMDS</a></li>
<li class="chapter" data-level="13.5" data-path="multivariate-stats.html"><a href="multivariate-stats.html#permanova"><i class="fa fa-check"></i><b>13.5</b> PERMANOVA</a></li>
<li class="chapter" data-level="13.6" data-path="multivariate-stats.html"><a href="multivariate-stats.html#cca"><i class="fa fa-check"></i><b>13.6</b> CCA</a></li>
<li class="chapter" data-level="13.7" data-path="multivariate-stats.html"><a href="multivariate-stats.html#load-packages"><i class="fa fa-check"></i><b>13.7</b> Load packages</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>14</b> Time Series</a></li>
<li class="chapter" data-level="15" data-path="github.html"><a href="github.html"><i class="fa fa-check"></i><b>15</b> GitHub</a></li>
<li class="chapter" data-level="16" data-path="useful-resources.html"><a href="useful-resources.html"><i class="fa fa-check"></i><b>16</b> Useful Resources</a></li>
<li class="chapter" data-level="17" data-path="instructions.html"><a href="instructions.html"><i class="fa fa-check"></i><b>17</b> Instructions</a>
<ul>
<li class="chapter" data-level="17.1" data-path="instructions.html"><a href="instructions.html#about"><i class="fa fa-check"></i><b>17.1</b> About</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="instructions.html"><a href="instructions.html#usage"><i class="fa fa-check"></i><b>17.1.1</b> Usage</a></li>
<li class="chapter" data-level="17.1.2" data-path="instructions.html"><a href="instructions.html#render-book"><i class="fa fa-check"></i><b>17.1.2</b> Render book</a></li>
<li class="chapter" data-level="17.1.3" data-path="instructions.html"><a href="instructions.html#preview-book"><i class="fa fa-check"></i><b>17.1.3</b> Preview book</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="instructions.html"><a href="instructions.html#introduction"><i class="fa fa-check"></i><b>17.2</b> Introduction</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="instructions.html"><a href="instructions.html#a-section"><i class="fa fa-check"></i><b>17.2.1</b> A section</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="instructions.html"><a href="instructions.html#cross-references-and-chapters"><i class="fa fa-check"></i><b>17.3</b> Cross references and chapters</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="instructions.html"><a href="instructions.html#chapters-and-sub-chapters"><i class="fa fa-check"></i><b>17.3.1</b> Chapters and sub-chapters</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="instructions.html"><a href="instructions.html#captioned-figures-and-tables"><i class="fa fa-check"></i><b>17.4</b> Captioned figures and tables</a></li>
<li class="chapter" data-level="17.5" data-path="instructions.html"><a href="instructions.html#parts"><i class="fa fa-check"></i><b>17.5</b> Parts</a></li>
<li class="chapter" data-level="17.6" data-path="instructions.html"><a href="instructions.html#footnotes-and-citations"><i class="fa fa-check"></i><b>17.6</b> Footnotes and Citations</a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="instructions.html"><a href="instructions.html#footnotes"><i class="fa fa-check"></i><b>17.6.1</b> Footnotes</a></li>
<li class="chapter" data-level="17.6.2" data-path="instructions.html"><a href="instructions.html#citations"><i class="fa fa-check"></i><b>17.6.2</b> Citations</a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="instructions.html"><a href="instructions.html#blocks"><i class="fa fa-check"></i><b>17.7</b> Blocks</a>
<ul>
<li class="chapter" data-level="17.7.1" data-path="instructions.html"><a href="instructions.html#equations"><i class="fa fa-check"></i><b>17.7.1</b> Equations</a></li>
<li class="chapter" data-level="17.7.2" data-path="instructions.html"><a href="instructions.html#theorems-and-proofs"><i class="fa fa-check"></i><b>17.7.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="17.7.3" data-path="instructions.html"><a href="instructions.html#callout-blocks"><i class="fa fa-check"></i><b>17.7.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="17.8" data-path="instructions.html"><a href="instructions.html#publishing"><i class="fa fa-check"></i><b>17.8</b> Publishing</a>
<ul>
<li class="chapter" data-level="17.8.1" data-path="instructions.html"><a href="instructions.html#pages"><i class="fa fa-check"></i><b>17.8.1</b> 404 pages</a></li>
<li class="chapter" data-level="17.8.2" data-path="instructions.html"><a href="instructions.html#metadata-for-sharing"><i class="fa fa-check"></i><b>17.8.2</b> Metadata for sharing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Coding Bookdown for EMRR</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-exploration-and-qaqc" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Data Exploration and QA/QC</h1>
<div id="recommended-reference-material" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> 1 Recommended Reference Material</h2>
<p>There are probably many references for exploring your data. I don’t necessarily follow any particular reference, but rather try a few different kinds of plots to pull out different aspects of the data. Depending on the analysis you are doing, you will also probably want to do some different kinds of exploration.</p>
<p>Two sources I have used, however, are (Zuur et al. 2009), which includes some steps for data exploration prior to launching into mixed effects modeling (Chapter 2 and Appendix A), and (Wickham and Grolemund 2017), which has some useful information about visualizing data and exploratory data analysis, as well as other information about coding in the tidyverse (see below for description of the tidyverse).</p>
</div>
<div id="background" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> 2 Background</h2>
<p>Data exploration often occurs at multiple stages of an analysis. The initial data exploration is important for finding the issues with your data, and for getting an idea of what analyses you can perform. This training will include some examples of plots and code to help you look at the relationships between variables, including:</p>
<ul>
<li>Data over time</li>
<li>Data over space</li>
<li>Variability of data</li>
<li>Collinearity</li>
<li>Distribution of data</li>
<li>How balanced your data are</li>
<li>Missing data</li>
<li>Outliers</li>
</ul>
<p>I will be conducting the majority of my data exploration using the <a href="https://www.tidyverse.org/">tidyverse</a>. The tidyverse is a collection of packages that use similar coding language to do things such as filter, reformat, manipulate, plot your code. You can call all the tidyverse packages using <code>library(tidyverse)</code>. There are also many ways to conduct data exploration using base R and other packages.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="prepare-your-data" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> 3 Prepare your data</h2>
<p>Load packages</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="data-exploration-and-qaqc.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear your environment</span></span>
<span id="cb83-2"><a href="data-exploration-and-qaqc.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>(<span class="at">all=</span><span class="cn">TRUE</span>))</span>
<span id="cb83-3"><a href="data-exploration-and-qaqc.html#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="data-exploration-and-qaqc.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr) <span class="co"># Read in data</span></span>
<span id="cb83-5"><a href="data-exploration-and-qaqc.html#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># Manipulate data</span></span>
<span id="cb83-6"><a href="data-exploration-and-qaqc.html#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># Pivot data</span></span>
<span id="cb83-7"><a href="data-exploration-and-qaqc.html#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># Datetimes</span></span>
<span id="cb83-8"><a href="data-exploration-and-qaqc.html#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly) <span class="co"># Interactive plotting</span></span>
<span id="cb83-9"><a href="data-exploration-and-qaqc.html#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych) <span class="co"># Correlation plots</span></span>
<span id="cb83-10"><a href="data-exploration-and-qaqc.html#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis) <span class="co"># Color palettes</span></span>
<span id="cb83-11"><a href="data-exploration-and-qaqc.html#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ODWGtools) <span class="co"># Tukey and MAD tests</span></span>
<span id="cb83-12"><a href="data-exploration-and-qaqc.html#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet) <span class="co"># Interactive maps</span></span>
<span id="cb83-13"><a href="data-exploration-and-qaqc.html#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr) <span class="co"># dotplot</span></span>
<span id="cb83-14"><a href="data-exploration-and-qaqc.html#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="co">#source(&quot;corvif.R&quot;) # From Zuur et al. 2009 for calculating VIF</span></span></code></pre></div>
<p>Create a theme to make font sizes slightly bigger for plots. I have put in an option to rotate the x-axis text when needed (degree = 90 in those cases)</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="data-exploration-and-qaqc.html#cb84-1" aria-hidden="true" tabindex="-1"></a>theme_plots <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">degree =</span> <span class="dv">0</span>) {</span>
<span id="cb84-2"><a href="data-exploration-and-qaqc.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb84-3"><a href="data-exploration-and-qaqc.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">angle =</span> degree),</span>
<span id="cb84-4"><a href="data-exploration-and-qaqc.html#cb84-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb84-5"><a href="data-exploration-and-qaqc.html#cb84-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb84-6"><a href="data-exploration-and-qaqc.html#cb84-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb84-7"><a href="data-exploration-and-qaqc.html#cb84-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb84-8"><a href="data-exploration-and-qaqc.html#cb84-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span>
<span id="cb84-9"><a href="data-exploration-and-qaqc.html#cb84-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="get-data" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Get data</h3>
<p>Let’s work with DWR’s Yolo Bypass Fish Monitoring Program’s Beach Seine (fish) data, which contains both water quality and fish data.This is available on EDI, but I saved a version of it for the training. Here is code below if you want to read the whole dataset from EDI.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="data-exploration-and-qaqc.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get URLs from EDI</span></span>
<span id="cb85-2"><a href="data-exploration-and-qaqc.html#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># URL_fish &lt;- &quot;https://portal.edirepository.org/nis/dataviewer?packageid=edi.233.2&amp;entityid=015e494911cf35c90089ced5a3127334&quot;</span></span>
<span id="cb85-3"><a href="data-exploration-and-qaqc.html#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="data-exploration-and-qaqc.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="cb85-5"><a href="data-exploration-and-qaqc.html#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fishData &lt;- readr::read_csv(URL_fish,show_col_types = FALSE)%&gt;%</span></span>
<span id="cb85-6"><a href="data-exploration-and-qaqc.html#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(MethodCode == &quot;BSEIN&quot;) </span></span>
<span id="cb85-7"><a href="data-exploration-and-qaqc.html#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="data-exploration-and-qaqc.html#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Write data </span></span>
<span id="cb85-9"><a href="data-exploration-and-qaqc.html#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fishData, &quot;ybfmp_fishdata.rds&quot;)</span></span></code></pre></div>
<p>Start here if data are already downloaded.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="data-exploration-and-qaqc.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read data</span></span>
<span id="cb86-2"><a href="data-exploration-and-qaqc.html#cb86-2" aria-hidden="true" tabindex="-1"></a>fishData <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/ybfmp_fishdata.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="develop-your-questions" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Develop your questions</h3>
<p>Before you explore, you may want to think about what your analysis questions will be to help you set up your data properly.</p>
<ul>
<li>What is/are your response variable(s)?</li>
<li>What is/are your predictor variable(s)?</li>
</ul>
<p>You will likely need to do some data manipulation to get your data into the format you want for your questions. You can explore the data to figure out if it’s already set up correctly, or if you need to manipulate it to be analyzing correctly.</p>
<p>For examples, let’s say your question is: <strong>Is native fish abundance correlated with space, time, and water quality?</strong> You’ll want to have the appropriate time, space, abundance metrics.</p>
<p>Take a look at how R is seeing the data. It is important to make sure the “class” (e.g. character, factor double, logical, datetime) is correct when you analyze your data, otherwise you may run into errors:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="data-exploration-and-qaqc.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(fishData)</span></code></pre></div>
<pre><code>## Rows: 87,295
## Columns: 32
## $ SampleDate           &lt;chr&gt; &quot;1/16/1998&quot;, &quot;1/16/1998&quot;, &quot;1/30/1998&quot;, &quot;1/30/1998~
## $ SampleTime           &lt;time&gt; 14:05:00, 15:00:00, 13:50:00, 13:50:00, 13:50:00~
## $ StationCode          &lt;chr&gt; &quot;YB&quot;, &quot;YB&quot;, &quot;YB&quot;, &quot;YB&quot;, &quot;YB&quot;, &quot;YB&quot;, &quot;YB&quot;, &quot;YB&quot;, &quot;~
## $ MethodCode           &lt;chr&gt; &quot;BSEIN&quot;, &quot;BSEIN&quot;, &quot;BSEIN&quot;, &quot;BSEIN&quot;, &quot;BSEIN&quot;, &quot;BSE~
## $ GearID               &lt;chr&gt; &quot;SEIN50&quot;, &quot;SEIN50&quot;, &quot;SEIN50&quot;, &quot;SEIN50&quot;, &quot;SEIN50&quot;,~
## $ CommonName           &lt;chr&gt; &quot;Threadfin Shad&quot;, &quot;Inland Silverside&quot;, &quot;Inland Si~
## $ GeneticallyConfirmed &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;~
## $ GeneticID            &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ Field_ID_CommonName  &lt;chr&gt; &quot;Threadfin Shad&quot;, &quot;Inland Silverside&quot;, &quot;Inland Si~
## $ ForkLength           &lt;dbl&gt; 90, 73, 56, 59, 39, 50, 37, 40, 49, 50, 22, 81, 4~
## $ Count                &lt;dbl&gt; 1, 1, 1, 2, 2, 1, 1, 2, 2, 1, 1, 1, 3, 1, 1, 1, 1~
## $ FishSex              &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ Race                 &lt;chr&gt; &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;F&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;n~
## $ MarkCode             &lt;chr&gt; &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, ~
## $ CWTSample            &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, ~
## $ FishTagID            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ StageCode            &lt;chr&gt; &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;n/p&quot;, &quot;CHN_P&quot;, &quot;n/p&quot;, &quot;n/p&quot;~
## $ Dead                 &lt;chr&gt; &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;No&quot;, &quot;~
## $ GearConditionCode    &lt;dbl&gt; 3, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1~
## $ WeatherCode          &lt;chr&gt; &quot;CLD&quot;, &quot;CLD&quot;, &quot;CLD&quot;, &quot;CLD&quot;, &quot;CLD&quot;, &quot;CLD&quot;, &quot;CLD&quot;, ~
## $ WaterTemperature     &lt;dbl&gt; 11.66667, 11.66667, 12.22222, 12.22222, 12.22222,~
## $ Secchi               &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ Conductivity         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ SpCnd                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ DO                   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ pH                   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ Turbidity            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ SubstrateCode        &lt;chr&gt; &quot;VG&quot;, &quot;MD&quot;, &quot;PV&quot;, &quot;PV&quot;, &quot;PV&quot;, &quot;PV&quot;, &quot;PV&quot;, &quot;PV&quot;, &quot;~
## $ Tide                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ VolumeSeined         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N~
## $ Latitude             &lt;dbl&gt; 38.56538, 38.56538, 38.56538, 38.56538, 38.56538,~
## $ Longitude            &lt;dbl&gt; -121.631, -121.631, -121.631, -121.631, -121.631,~</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="data-exploration-and-qaqc.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fishData)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 32
##   SampleDate SampleTime StationCode MethodCode GearID CommonName       
##   &lt;chr&gt;      &lt;time&gt;     &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;            
## 1 1/16/1998  14:05      YB          BSEIN      SEIN50 Threadfin Shad   
## 2 1/16/1998  15:00      YB          BSEIN      SEIN50 Inland Silverside
## 3 1/30/1998  13:50      YB          BSEIN      SEIN50 Inland Silverside
## 4 1/30/1998  13:50      YB          BSEIN      SEIN50 Inland Silverside
## 5 1/30/1998  13:50      YB          BSEIN      SEIN50 Chinook Salmon   
## 6 1/30/1998  13:50      YB          BSEIN      SEIN50 Inland Silverside
## # ... with 26 more variables: GeneticallyConfirmed &lt;chr&gt;, GeneticID &lt;lgl&gt;,
## #   Field_ID_CommonName &lt;chr&gt;, ForkLength &lt;dbl&gt;, Count &lt;dbl&gt;, FishSex &lt;chr&gt;,
## #   Race &lt;chr&gt;, MarkCode &lt;chr&gt;, CWTSample &lt;lgl&gt;, FishTagID &lt;chr&gt;,
## #   StageCode &lt;chr&gt;, Dead &lt;chr&gt;, GearConditionCode &lt;dbl&gt;, WeatherCode &lt;chr&gt;,
## #   WaterTemperature &lt;dbl&gt;, Secchi &lt;dbl&gt;, Conductivity &lt;dbl&gt;, SpCnd &lt;dbl&gt;,
## #   DO &lt;dbl&gt;, pH &lt;dbl&gt;, Turbidity &lt;dbl&gt;, SubstrateCode &lt;chr&gt;, Tide &lt;chr&gt;,
## #   VolumeSeined &lt;dbl&gt;, Latitude &lt;dbl&gt;, Longitude &lt;dbl&gt;</code></pre>
<ul>
<li>Response variable: Native fish CPUE
<ul>
<li>Filter to relevant species, calculate daily CPUE (data currently by count, and broken up by species)</li>
</ul></li>
<li>Predictor variables: Water Year, Month, WQ, Station:
<ul>
<li>You will want to extract datetime variables</li>
<li>Filter to stations of interest</li>
</ul></li>
</ul>
</div>
<div id="manipulate-data" class="section level3" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Manipulate data</h3>
<blockquote>
<p>Here you will see me use <code>%&gt;%</code> fairly often. This is called a pipe and basically will allow you to continue running operations on the data frame called at the beginning, and let you avoid having to name multiple intermediate data frames. Below, I create a new data frame <code>fishSeine</code> that is based on the existing data frame <code>fishData</code>. Then I add/edit variables using <code>mutate</code>, filter data using <code>filter</code>, and select columns I don’t want using <code>select</code>. See more about pipes and data manipulation functions in Wickham &amp; Grolemund 2017, Chapter 5.</p>
</blockquote>
<p>Add some datetime variables, make sure they are the right class. Filter beach seine data from 2010-2015.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="data-exploration-and-qaqc.html#cb91-1" aria-hidden="true" tabindex="-1"></a>fishSeine <span class="ot">&lt;-</span> fishData <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="data-exploration-and-qaqc.html#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Calculate CPUE, add datetime variables</span></span>
<span id="cb91-3"><a href="data-exploration-and-qaqc.html#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CPUE =</span> Count<span class="sc">/</span>VolumeSeined,</span>
<span id="cb91-4"><a href="data-exploration-and-qaqc.html#cb91-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date =</span> lubridate<span class="sc">::</span><span class="fu">mdy</span>(SampleDate),</span>
<span id="cb91-5"><a href="data-exploration-and-qaqc.html#cb91-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Datetime =</span> <span class="fu">paste</span>(Date, SampleTime),</span>
<span id="cb91-6"><a href="data-exploration-and-qaqc.html#cb91-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Datetime =</span> lubridate<span class="sc">::</span><span class="fu">ymd_hms</span>(Datetime),</span>
<span id="cb91-7"><a href="data-exploration-and-qaqc.html#cb91-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(Date),</span>
<span id="cb91-8"><a href="data-exploration-and-qaqc.html#cb91-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">fYear =</span> <span class="fu">factor</span>(Year),</span>
<span id="cb91-9"><a href="data-exploration-and-qaqc.html#cb91-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">Month =</span> lubridate<span class="sc">::</span><span class="fu">month</span>(Date),</span>
<span id="cb91-10"><a href="data-exploration-and-qaqc.html#cb91-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">fMonth =</span> <span class="fu">factor</span>(Month),</span>
<span id="cb91-11"><a href="data-exploration-and-qaqc.html#cb91-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">WY =</span> <span class="fu">ifelse</span>(Month <span class="sc">&gt;</span><span class="dv">9</span>, Year <span class="sc">+</span> <span class="dv">1</span>, Year),</span>
<span id="cb91-12"><a href="data-exploration-and-qaqc.html#cb91-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">fWY =</span> <span class="fu">factor</span>(WY))<span class="sc">%&gt;%</span></span>
<span id="cb91-13"><a href="data-exploration-and-qaqc.html#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove samples in bad condition, filter to a smaller timespan and station list</span></span>
<span id="cb91-14"><a href="data-exploration-and-qaqc.html#cb91-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GearConditionCode <span class="sc">&lt;</span><span class="dv">3</span>,</span>
<span id="cb91-15"><a href="data-exploration-and-qaqc.html#cb91-15" aria-hidden="true" tabindex="-1"></a>         Year<span class="sc">&gt;</span><span class="dv">2009</span> <span class="sc">&amp;</span> Year<span class="sc">&lt;</span><span class="dv">2016</span>)<span class="sc">%&gt;%</span></span>
<span id="cb91-16"><a href="data-exploration-and-qaqc.html#cb91-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove variables not needed</span></span>
<span id="cb91-17"><a href="data-exploration-and-qaqc.html#cb91-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SampleTime, <span class="sc">-</span>SampleDate, <span class="sc">-</span>GearID, <span class="sc">-</span>GearConditionCode, </span>
<span id="cb91-18"><a href="data-exploration-and-qaqc.html#cb91-18" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>MethodCode, <span class="sc">-</span>ForkLength, </span>
<span id="cb91-19"><a href="data-exploration-and-qaqc.html#cb91-19" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>GeneticallyConfirmed, <span class="sc">-</span>GeneticID, <span class="sc">-</span>Field_ID_CommonName, <span class="sc">-</span>FishSex, </span>
<span id="cb91-20"><a href="data-exploration-and-qaqc.html#cb91-20" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>MarkCode, <span class="sc">-</span>CWTSample, <span class="sc">-</span>StageCode, <span class="sc">-</span>Dead, <span class="sc">-</span>FishTagID, <span class="sc">-</span>Race, </span>
<span id="cb91-21"><a href="data-exploration-and-qaqc.html#cb91-21" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>SubstrateCode)</span></code></pre></div>
<p>Take a look at how the fish data are set up.</p>
<ul>
<li>For this dataset, only a certain number of fish are measured and the rest are counted. We want just one count per day, so this is done here.</li>
<li>Many datasets only report on what they have caught, and not which species have not been caught. This can skew the CPUE if you are looking at averages by species. Here we fill in zeroes for species not caught.</li>
</ul>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="data-exploration-and-qaqc.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Some more that needs to be done to fish counts</span></span>
<span id="cb92-2"><a href="data-exploration-and-qaqc.html#cb92-2" aria-hidden="true" tabindex="-1"></a>fishSeineC <span class="ot">&lt;-</span> fishSeine <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="data-exploration-and-qaqc.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sum to one count per species per datetime and station </span></span>
<span id="cb92-4"><a href="data-exploration-and-qaqc.html#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (data not formatted this way since some fish have lengths and others do not)</span></span>
<span id="cb92-5"><a href="data-exploration-and-qaqc.html#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(StationCode, Datetime, CommonName) <span class="sc">%&gt;%</span></span>
<span id="cb92-6"><a href="data-exploration-and-qaqc.html#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Count2 =</span> <span class="fu">sum</span>(Count),</span>
<span id="cb92-7"><a href="data-exploration-and-qaqc.html#cb92-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">CPUE2 =</span> <span class="fu">sum</span>(CPUE),</span>
<span id="cb92-8"><a href="data-exploration-and-qaqc.html#cb92-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">Volume2 =</span> <span class="fu">sum</span>(VolumeSeined)) <span class="sc">%&gt;%</span></span>
<span id="cb92-9"><a href="data-exploration-and-qaqc.html#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-10"><a href="data-exploration-and-qaqc.html#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Count, <span class="sc">-</span>CPUE, <span class="sc">-</span>VolumeSeined) <span class="sc">%&gt;%</span></span>
<span id="cb92-11"><a href="data-exploration-and-qaqc.html#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-12"><a href="data-exploration-and-qaqc.html#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Count =</span> Count2, <span class="at">CPUE =</span> CPUE2, <span class="at">VolumeSeined =</span> Volume2) <span class="sc">%&gt;%</span></span>
<span id="cb92-13"><a href="data-exploration-and-qaqc.html#cb92-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(CommonName) <span class="sc">%&gt;%</span></span>
<span id="cb92-14"><a href="data-exploration-and-qaqc.html#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add zeroes in</span></span>
<span id="cb92-15"><a href="data-exploration-and-qaqc.html#cb92-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> CommonName, <span class="at">values_from =</span> CPUE,<span class="at">values_fill =</span> 0L) <span class="sc">%&gt;%</span></span>
<span id="cb92-16"><a href="data-exploration-and-qaqc.html#cb92-16" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>(., <span class="at">case =</span> <span class="st">&quot;lower_camel&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-17"><a href="data-exploration-and-qaqc.html#cb92-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>noCatch) <span class="sc">%&gt;%</span></span>
<span id="cb92-18"><a href="data-exploration-and-qaqc.html#cb92-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(americanShad<span class="sc">:</span>yellowfinGoby), </span>
<span id="cb92-19"><a href="data-exploration-and-qaqc.html#cb92-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;commonName&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;cpue&quot;</span>) </span></code></pre></div>
<p>Let’s reduce to just a few stations for now.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="data-exploration-and-qaqc.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out stations of interest</span></span>
<span id="cb93-2"><a href="data-exploration-and-qaqc.html#cb93-2" aria-hidden="true" tabindex="-1"></a>fishSeineS <span class="ot">&lt;-</span> fishSeineC <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="data-exploration-and-qaqc.html#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stationCode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;AL2&quot;</span>,<span class="st">&quot;LI&quot;</span>, <span class="st">&quot;BL2&quot;</span>, <span class="st">&quot;BL4&quot;</span>))</span></code></pre></div>
<p>Create native species subset of data.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="data-exploration-and-qaqc.html#cb94-1" aria-hidden="true" tabindex="-1"></a>nativespecies <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;chinookSalmon&quot;</span>, <span class="st">&quot;splittail&quot;</span>, <span class="st">&quot;sacramentoBlackfish&quot;</span>, </span>
<span id="cb94-2"><a href="data-exploration-and-qaqc.html#cb94-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;sacramentoPikeminnow&quot;</span>, <span class="st">&quot;sacramentoSucker&quot;</span>, <span class="st">&quot;hardhead&quot;</span>, </span>
<span id="cb94-3"><a href="data-exploration-and-qaqc.html#cb94-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;tulePerch&quot;</span>, <span class="st">&quot;hitch&quot;</span>)</span>
<span id="cb94-4"><a href="data-exploration-and-qaqc.html#cb94-4" aria-hidden="true" tabindex="-1"></a>fishNative <span class="ot">&lt;-</span> <span class="fu">filter</span>(fishSeineS, commonName <span class="sc">%in%</span> nativespecies)</span></code></pre></div>
<p>Let’s just have one CPUE for all fish per day.</p>
<ul>
<li>native fish of interest</li>
<li>all fish</li>
</ul>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="data-exploration-and-qaqc.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to some natives</span></span>
<span id="cb95-2"><a href="data-exploration-and-qaqc.html#cb95-2" aria-hidden="true" tabindex="-1"></a>fishCPUE_n <span class="ot">&lt;-</span> fishNative <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="data-exploration-and-qaqc.html#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stationCode, date, year, fWy, fMonth) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="data-exploration-and-qaqc.html#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sumCPUE =</span> <span class="fu">sum</span>(cpue)) <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="data-exploration-and-qaqc.html#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb95-6"><a href="data-exploration-and-qaqc.html#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="data-exploration-and-qaqc.html#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="co"># All fish</span></span>
<span id="cb95-8"><a href="data-exploration-and-qaqc.html#cb95-8" aria-hidden="true" tabindex="-1"></a>fishCPUE <span class="ot">&lt;-</span> fishSeineS <span class="sc">%&gt;%</span></span>
<span id="cb95-9"><a href="data-exploration-and-qaqc.html#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stationCode, date, year, fWy, fMonth) <span class="sc">%&gt;%</span></span>
<span id="cb95-10"><a href="data-exploration-and-qaqc.html#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sumCPUE =</span> <span class="fu">sum</span>(cpue)) <span class="sc">%&gt;%</span></span>
<span id="cb95-11"><a href="data-exploration-and-qaqc.html#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Daily native fish CPUE for all stations (for spatial data examples)</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="data-exploration-and-qaqc.html#cb96-1" aria-hidden="true" tabindex="-1"></a>fishSeineNatives <span class="ot">&lt;-</span> fishSeineC <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="data-exploration-and-qaqc.html#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(commonName <span class="sc">%in%</span> nativespecies) <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="data-exploration-and-qaqc.html#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(wy, date, stationCode, latitude, longitude) <span class="sc">%&gt;%</span></span>
<span id="cb96-4"><a href="data-exploration-and-qaqc.html#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sumCPUE =</span> <span class="fu">sum</span>(cpue)) <span class="sc">%&gt;%</span></span>
<span id="cb96-5"><a href="data-exploration-and-qaqc.html#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wy<span class="sc">&gt;</span><span class="dv">2011</span> <span class="sc">&amp;</span> wy<span class="sc">&lt;</span><span class="dv">2015</span>) <span class="sc">%&gt;%</span></span>
<span id="cb96-6"><a href="data-exploration-and-qaqc.html#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fWy =</span> <span class="fu">factor</span>(wy),</span>
<span id="cb96-7"><a href="data-exploration-and-qaqc.html#cb96-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">fMonth =</span> <span class="fu">factor</span>(<span class="fu">month</span>(date)))</span>
<span id="cb96-8"><a href="data-exploration-and-qaqc.html#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="data-exploration-and-qaqc.html#cb96-9" aria-hidden="true" tabindex="-1"></a>fishAnnualNatives <span class="ot">&lt;-</span> fishSeineNatives <span class="sc">%&gt;%</span></span>
<span id="cb96-10"><a href="data-exploration-and-qaqc.html#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fWy, stationCode, latitude, longitude) <span class="sc">%&gt;%</span></span>
<span id="cb96-11"><a href="data-exploration-and-qaqc.html#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sumcpue =</span> <span class="fu">sum</span>(sumCPUE),</span>
<span id="cb96-12"><a href="data-exploration-and-qaqc.html#cb96-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<p>Let’s also separate water quality so we can look at these variables for outliers. I like to put my data in long (all parameters in one column, all values in one column) to look at lots of different variables at the same time.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="data-exploration-and-qaqc.html#cb97-1" aria-hidden="true" tabindex="-1"></a>fish_WQ <span class="ot">&lt;-</span> fishSeineS <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="data-exploration-and-qaqc.html#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, year, fWy, fMonth, stationCode, waterTemperature, </span>
<span id="cb97-3"><a href="data-exploration-and-qaqc.html#cb97-3" aria-hidden="true" tabindex="-1"></a>         conductivity, do, pH, secchi, turbidity, latitude, longitude) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="data-exploration-and-qaqc.html#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb97-5"><a href="data-exploration-and-qaqc.html#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">samplingId =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb97-6"><a href="data-exploration-and-qaqc.html#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="data-exploration-and-qaqc.html#cb97-7" aria-hidden="true" tabindex="-1"></a>WQ_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(fish_WQ, <span class="at">cols =</span> waterTemperature<span class="sc">:</span>turbidity, </span>
<span id="cb97-8"><a href="data-exploration-and-qaqc.html#cb97-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>, </span>
<span id="cb97-9"><a href="data-exploration-and-qaqc.html#cb97-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-10"><a href="data-exploration-and-qaqc.html#cb97-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb97-11"><a href="data-exploration-and-qaqc.html#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="data-exploration-and-qaqc.html#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(WQ_long <span class="sc">%&gt;%</span><span class="fu">select</span>(date, parameter, value), <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    date       parameter          value
##    &lt;date&gt;     &lt;chr&gt;              &lt;dbl&gt;
##  1 2010-07-28 waterTemperature  27.2  
##  2 2010-07-28 conductivity     358    
##  3 2010-07-28 do                 8.64 
##  4 2010-07-28 pH                 8.12 
##  5 2010-07-28 secchi             0.140
##  6 2010-07-28 turbidity         NA    
##  7 2011-07-12 waterTemperature  23.3  
##  8 2011-07-12 conductivity     587    
##  9 2011-07-12 do                 6.33 
## 10 2011-07-12 pH                 8.32</code></pre>
<p>Combine summed CPUE data with variables.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="data-exploration-and-qaqc.html#cb99-1" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">left_join</span>(fishCPUE, fish_WQ) <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="data-exploration-and-qaqc.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fWy, fMonth, date, stationCode, </span>
<span id="cb99-3"><a href="data-exploration-and-qaqc.html#cb99-3" aria-hidden="true" tabindex="-1"></a>         sumCPUE, waterTemperature, conductivity, </span>
<span id="cb99-4"><a href="data-exploration-and-qaqc.html#cb99-4" aria-hidden="true" tabindex="-1"></a>         turbidity, secchi, do, pH, latitude, longitude)</span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="examine-patterns-and-relationships-between-response-and-predictor" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> 4 Examine patterns and relationships between response and predictor</h2>
<p>We can use tables and plots to look at the data in different ways, and gather different types of information about your data and data structure. Grouping by different variables will help you identify outliers, gaps, and learn about your data.</p>
<div id="a-data-over-time" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> A) Data over time</h3>
<p>Dotplots plot your data by row, which usually means it is plotted in order of time. This can be useful for finding outliers.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="data-exploration-and-qaqc.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dotchart</span>(vars<span class="sc">$</span>sumCPUE, <span class="at">bg =</span> <span class="st">&quot;springgreen4&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
<p>You can also group by station (though so many values, it is hard to see)</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="data-exploration-and-qaqc.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dotchart</span>(vars<span class="sc">$</span>sumCPUE, <span class="at">labels =</span> vars<span class="sc">$</span>stationCode, </span>
<span id="cb101-2"><a href="data-exploration-and-qaqc.html#cb101-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">groups =</span> vars<span class="sc">$</span>longitude, </span>
<span id="cb101-3"><a href="data-exploration-and-qaqc.html#cb101-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg =</span> <span class="fu">viridis</span>(<span class="dv">4</span>, <span class="at">option =</span> <span class="st">&quot;magma&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
<p>Point plots basically flip this, and it is easy to color code by different variables. You can do this by date label. Here I have also added some lines at the beginning of each water year to help split the plot up.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="data-exploration-and-qaqc.html#cb102-1" aria-hidden="true" tabindex="-1"></a>(Seine_pointplots <span class="ot">&lt;-</span> vars <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="data-exploration-and-qaqc.html#cb102-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> date, <span class="at">y =</span> sumCPUE, <span class="at">color =</span> stationCode)) <span class="sc">+</span> </span>
<span id="cb102-3"><a href="data-exploration-and-qaqc.html#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb102-4"><a href="data-exploration-and-qaqc.html#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2010-10-01&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb102-5"><a href="data-exploration-and-qaqc.html#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2011-10-01&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb102-6"><a href="data-exploration-and-qaqc.html#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2012-10-01&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb102-7"><a href="data-exploration-and-qaqc.html#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2013-10-01&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb102-8"><a href="data-exploration-and-qaqc.html#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2014-10-01&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb102-9"><a href="data-exploration-and-qaqc.html#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2015-10-01&quot;</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb102-10"><a href="data-exploration-and-qaqc.html#cb102-10" aria-hidden="true" tabindex="-1"></a>    viridis<span class="sc">::</span><span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span> </span>
<span id="cb102-11"><a href="data-exploration-and-qaqc.html#cb102-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_date</span>(<span class="at">breaks =</span> <span class="st">&quot;6 months&quot;</span>) <span class="sc">+</span></span>
<span id="cb102-12"><a href="data-exploration-and-qaqc.html#cb102-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_plots</span>(<span class="dv">90</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
</div>
<div id="b-data-over-space" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> B) Data over space</h3>
<p>If you have a lot of stations, it can be good to check your latitudes and longitudes are correct, get an idea of the area of the dataset, how you might want to divide up regions, etc., as well as a quick look at spatial trends, if that is one of your questions.</p>
<p>Create a data frame of stations.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="data-exploration-and-qaqc.html#cb103-1" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">&lt;-</span> fishSeineNatives <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="data-exploration-and-qaqc.html#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(stationCode, longitude, latitude, sumCPUE) <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="data-exploration-and-qaqc.html#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stationCode, longitude, latitude) <span class="sc">%&gt;%</span></span>
<span id="cb103-4"><a href="data-exploration-and-qaqc.html#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sumCPUE <span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb103-5"><a href="data-exploration-and-qaqc.html#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="co"># just picking one value per </span></span>
<span id="cb103-6"><a href="data-exploration-and-qaqc.html#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#station for this exercise. </span></span>
<span id="cb103-7"><a href="data-exploration-and-qaqc.html#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#slice picks the first value</span></span>
<span id="cb103-8"><a href="data-exploration-and-qaqc.html#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for each station-lon-lat combo.</span></span>
<span id="cb103-9"><a href="data-exploration-and-qaqc.html#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sumCPUE =</span> <span class="fu">round</span>(sumCPUE,<span class="dv">3</span>)) </span>
<span id="cb103-10"><a href="data-exploration-and-qaqc.html#cb103-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># round CPUE so it&#39;s not a crazy long number </span></span>
<span id="cb103-11"><a href="data-exploration-and-qaqc.html#cb103-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># when it pops up on leaflet.</span></span></code></pre></div>
<p>I am going to use the <a href="%22https://rstudio.github.io/leaflet/%22">leaflet</a> package here, which allows you to view your stations interactively. You can also view data associated with the station by using colors or size to visualize different variables.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="data-exploration-and-qaqc.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define your color palette by telling it what colors </span></span>
<span id="cb104-2"><a href="data-exploration-and-qaqc.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to use for which variable. You will need one color per level.</span></span>
<span id="cb104-3"><a href="data-exploration-and-qaqc.html#cb104-3" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorFactor</span>(viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="dv">13</span>), stations<span class="sc">$</span>stationCode)  </span>
<span id="cb104-4"><a href="data-exploration-and-qaqc.html#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="data-exploration-and-qaqc.html#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make map</span></span>
<span id="cb104-6"><a href="data-exploration-and-qaqc.html#cb104-6" aria-hidden="true" tabindex="-1"></a>stations <span class="sc">%&gt;%</span></span>
<span id="cb104-7"><a href="data-exploration-and-qaqc.html#cb104-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span> <span class="co"># call leaflet.</span></span>
<span id="cb104-8"><a href="data-exploration-and-qaqc.html#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span> <span class="co"># this adds the map in the background.</span></span>
<span id="cb104-9"><a href="data-exploration-and-qaqc.html#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addCircleMarkers</span>(</span>
<span id="cb104-10"><a href="data-exploration-and-qaqc.html#cb104-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span><span class="fu">pal</span>(stationCode),</span>
<span id="cb104-11"><a href="data-exploration-and-qaqc.html#cb104-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">stroke =</span> <span class="cn">FALSE</span>, <span class="co"># alters whether there is a border to circle</span></span>
<span id="cb104-12"><a href="data-exploration-and-qaqc.html#cb104-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillOpacity =</span> <span class="fl">0.9</span>,</span>
<span id="cb104-13"><a href="data-exploration-and-qaqc.html#cb104-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">radius =</span> <span class="sc">~</span>sumCPUE<span class="sc">*</span><span class="dv">400</span>,</span>
<span id="cb104-14"><a href="data-exploration-and-qaqc.html#cb104-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">lng =</span> <span class="sc">~</span>longitude, <span class="co"># call your longitude column name</span></span>
<span id="cb104-15"><a href="data-exploration-and-qaqc.html#cb104-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="sc">~</span>latitude, <span class="co"># call you latitude column name</span></span>
<span id="cb104-16"><a href="data-exploration-and-qaqc.html#cb104-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="sc">~</span><span class="fu">paste</span>(stationCode, </span>
<span id="cb104-17"><a href="data-exploration-and-qaqc.html#cb104-17" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot; sumCPUE:&quot;</span>, sumCPUE,  </span>
<span id="cb104-18"><a href="data-exploration-and-qaqc.html#cb104-18" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;Lat:&quot;</span>, latitude, <span class="st">&quot;Long:&quot;</span>, longitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-19"><a href="data-exploration-and-qaqc.html#cb104-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># edit what you want to show up in your label</span></span>
<span id="cb104-20"><a href="data-exploration-and-qaqc.html#cb104-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLegend</span>(<span class="at">pal =</span> pal,</span>
<span id="cb104-21"><a href="data-exploration-and-qaqc.html#cb104-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">values =</span> <span class="sc">~</span>stationCode,</span>
<span id="cb104-22"><a href="data-exploration-and-qaqc.html#cb104-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="st">&quot;bottomright&quot;</span>)</span></code></pre></div>
<div style="page-break-after: always;"></div>
<p>You can also look at some patterns in the data in ggplot. Here you might note that certain stations have greater CPUE across years while others fluctuate, and also that stations are not all sampled each year.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="data-exploration-and-qaqc.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fishAnnualNatives, <span class="fu">aes</span>(longitude, latitude, </span>
<span id="cb105-2"><a href="data-exploration-and-qaqc.html#cb105-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> sumcpue, <span class="at">color =</span> stationCode), </span>
<span id="cb105-3"><a href="data-exploration-and-qaqc.html#cb105-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb105-4"><a href="data-exploration-and-qaqc.html#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span> </span>
<span id="cb105-5"><a href="data-exploration-and-qaqc.html#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>fWy) <span class="sc">+</span> </span>
<span id="cb105-6"><a href="data-exploration-and-qaqc.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>, <span class="at">discrete =</span> <span class="cn">TRUE</span>)<span class="sc">+</span> </span>
<span id="cb105-7"><a href="data-exploration-and-qaqc.html#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_plots</span>(<span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb105-8"><a href="data-exploration-and-qaqc.html#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb105-9"><a href="data-exploration-and-qaqc.html#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T),</span>
<span id="cb105-10"><a href="data-exploration-and-qaqc.html#cb105-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
</div>
<div id="c-variability-of-data-and-continuous-categorical-relationships" class="section level3" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> C) Variability of data and continuous-categorical relationships</h3>
<p>We can use <strong>boxplots</strong> to look at the variability of your continuous data by categorical variables, and also to identify major outliers.</p>
<div id="by-station" class="section level4" number="9.4.3.1">
<h4><span class="header-section-number">9.4.3.1</span> By Station</h4>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="data-exploration-and-qaqc.html#cb106-1" aria-hidden="true" tabindex="-1"></a>(Seine_boxplot <span class="ot">&lt;-</span> WQ_long <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="data-exploration-and-qaqc.html#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> stationCode, <span class="at">y =</span> value, <span class="at">fill =</span> stationCode)) <span class="sc">+</span> </span>
<span id="cb106-3"><a href="data-exploration-and-qaqc.html#cb106-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb106-4"><a href="data-exploration-and-qaqc.html#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-5"><a href="data-exploration-and-qaqc.html#cb106-5" aria-hidden="true" tabindex="-1"></a>  viridis<span class="sc">::</span><span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-6"><a href="data-exploration-and-qaqc.html#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_plots</span>(<span class="dv">90</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-65-1.png" width="672" />
</p>
</div>
<div id="by-water-year" class="section level4" number="9.4.3.2">
<h4><span class="header-section-number">9.4.3.2</span> By Water Year</h4>
<p>You might notice some different outliers when you look by year. You may also note some trends.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="data-exploration-and-qaqc.html#cb107-1" aria-hidden="true" tabindex="-1"></a>(Seine_boxplots_WY <span class="ot">&lt;-</span> WQ_long <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="data-exploration-and-qaqc.html#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> fWy, <span class="at">y =</span> value, <span class="at">fill =</span> fWy)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb107-3"><a href="data-exploration-and-qaqc.html#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb107-4"><a href="data-exploration-and-qaqc.html#cb107-4" aria-hidden="true" tabindex="-1"></a>  viridis<span class="sc">::</span><span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb107-5"><a href="data-exploration-and-qaqc.html#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_plots</span>(<span class="dv">90</span>)) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-66-1.png" width="672" />
</p>
</div>
<div id="by-station-and-water-year" class="section level4" number="9.4.3.3">
<h4><span class="header-section-number">9.4.3.3</span> By Station and Water Year</h4>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="data-exploration-and-qaqc.html#cb108-1" aria-hidden="true" tabindex="-1"></a>(Seine_boxplots_month <span class="ot">&lt;-</span> WQ_long <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href="data-exploration-and-qaqc.html#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> fWy, <span class="at">y =</span> value, <span class="at">fill =</span> stationCode)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb108-3"><a href="data-exploration-and-qaqc.html#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb108-4"><a href="data-exploration-and-qaqc.html#cb108-4" aria-hidden="true" tabindex="-1"></a>  viridis<span class="sc">::</span><span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb108-5"><a href="data-exploration-and-qaqc.html#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_plots</span>(<span class="dv">90</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-1.png" width="672" />

Boxplots are less useful for data with lots of zeroes, but can still pull out outliers. You could also plot fork length to look for outliers.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="data-exploration-and-qaqc.html#cb109-1" aria-hidden="true" tabindex="-1"></a>(Fish_boxplots <span class="ot">&lt;-</span> fishSeineNatives <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="data-exploration-and-qaqc.html#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> <span class="fu">factor</span>(wy), <span class="at">y =</span> sumCPUE, <span class="at">fill =</span> <span class="fu">factor</span>(wy))) <span class="sc">+</span> </span>
<span id="cb109-3"><a href="data-exploration-and-qaqc.html#cb109-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb109-4"><a href="data-exploration-and-qaqc.html#cb109-4" aria-hidden="true" tabindex="-1"></a>  viridis<span class="sc">::</span><span class="fu">scale_fill_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-5"><a href="data-exploration-and-qaqc.html#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_plots</span>(<span class="dv">90</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="d-collinearity-and-relationships-between-continuous-variables" class="section level3" number="9.4.4">
<h3><span class="header-section-number">9.4.4</span> D) Collinearity and relationships between continuous variables</h3>
<p><strong>Scatterplots</strong> are useful to look at relationships between continuous variables. These plots are useful:
1) to help you find outliers in variables that <em>should</em> be correlated
2) to help you see relationships that might be interesting to explore
3) to help determine whether certain variables may need to be removed for your model</p>
<div id="outlier-detection" class="section level4" number="9.4.4.1">
<h4><span class="header-section-number">9.4.4.1</span> Outlier detection</h4>
<p>Turbidity and Secchi, DO and Water Temperature should be correlated</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="data-exploration-and-qaqc.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vars,<span class="fu">aes</span>(turbidity, secchi)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>() <span class="sc">+</span> <span class="fu">theme_plots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="data-exploration-and-qaqc.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vars,<span class="fu">aes</span>(do, waterTemperature)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span> <span class="fu">theme_plots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-2.png" width="672" /></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="data-exploration-and-qaqc.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vars,<span class="fu">aes</span>(do, waterTemperature)) <span class="sc">+</span> </span>
<span id="cb112-2"><a href="data-exploration-and-qaqc.html#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb112-3"><a href="data-exploration-and-qaqc.html#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>stationCode) <span class="sc">+</span> <span class="fu">theme_plots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-3.png" width="672" />
Some possible outliers or strange things happening with the high do/high water temperature values at AL2</p>
<div style="page-break-after: always;"></div>
</div>
<div id="pairplots" class="section level4" number="9.4.4.2">
<h4><span class="header-section-number">9.4.4.2</span> Pairplots</h4>
<p>Pairplots and correlation coefficients are useful for identifying collinearity (variables that are correlated with each other)</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="data-exploration-and-qaqc.html#cb113-1" aria-hidden="true" tabindex="-1"></a>vars_filt <span class="ot">&lt;-</span> vars <span class="sc">%&gt;%</span> <span class="fu">select</span>(sumCPUE, waterTemperature, </span>
<span id="cb113-2"><a href="data-exploration-and-qaqc.html#cb113-2" aria-hidden="true" tabindex="-1"></a>                             conductivity, secchi, </span>
<span id="cb113-3"><a href="data-exploration-and-qaqc.html#cb113-3" aria-hidden="true" tabindex="-1"></a>                             turbidity, pH, do)</span>
<span id="cb113-4"><a href="data-exploration-and-qaqc.html#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="data-exploration-and-qaqc.html#cb113-5" aria-hidden="true" tabindex="-1"></a>(corr_plot <span class="ot">&lt;-</span> <span class="fu">pairs.panels</span>(vars_filt, </span>
<span id="cb113-6"><a href="data-exploration-and-qaqc.html#cb113-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">hist.col =</span> <span class="st">&quot;white&quot;</span>, </span>
<span id="cb113-7"><a href="data-exploration-and-qaqc.html#cb113-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cex.cor =</span> <span class="dv">1</span>, </span>
<span id="cb113-8"><a href="data-exploration-and-qaqc.html#cb113-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">pch =</span> <span class="dv">21</span>, <span class="at">stars =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<pre><code>## NULL</code></pre>
</div>
<div id="variance-inflation-factor-vif" class="section level4" number="9.4.4.3">
<h4><span class="header-section-number">9.4.4.3</span> Variance Inflation Factor (VIF)</h4>
<p>VIF is another way to assess collinearity. This value indicates the ratio of variance in the entire model to the variance for a model with each individual variable. Higher vif indicates greater collinearity. If values are below 3, they are acceptable to be included together in a model. If values are above 3, Zuur et al. 2010 recommends sequentially removing variables with vif&gt;3 until all values are below 3. Other sources may have other cutoffs, and you may make your own determinations for what to include in a model.</p>
<p>You can assess vif on a model using car::vif(). You can also run this corvif function (Zuur et al. 2009), which has been included as a separate file, or is available here:
<a href="https://highstat.com/Books/Book2/HighstatLibV10.R">corvif function</a>. Since we have not specified a model, I have used this function, which basically models the data in a linear model and calculates the vif.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="data-exploration-and-qaqc.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#corvif(vars_filt[,-1])</span></span></code></pre></div>
</div>
</div>
<div id="e-distribution-of-data" class="section level3" number="9.4.5">
<h3><span class="header-section-number">9.4.5</span> E) Distribution of data</h3>
<p>We can use <strong>histograms</strong> to look at the <strong>distribution</strong> of the data, and can also find outliers this way.</p>
<p>Here are some examples of distributions as a reference:</p>
<div class="figure">
<img src="images/distributions.png" alt="" />
<p class="caption">Probability Distributions, from Rasmus 2018</p>
</div>
<div style="page-break-after: always;"></div>
<p>Let’s take a look at the distribution of native fishes vs. all fish.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="data-exploration-and-qaqc.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fishCPUE_n, <span class="fu">aes</span>(sumCPUE)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb116-2"><a href="data-exploration-and-qaqc.html#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Native Fish&quot;</span>) <span class="sc">+</span> <span class="fu">theme_plots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="data-exploration-and-qaqc.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fishCPUE, <span class="fu">aes</span>(sumCPUE)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb117-2"><a href="data-exploration-and-qaqc.html#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;All Fish&quot;</span>) <span class="sc">+</span> <span class="fu">theme_plots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-72-2.png" width="672" /></p>
<p>You can also look at a histogram of sorts over multiple categories using a freqpoly plot.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="data-exploration-and-qaqc.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fishCPUE, <span class="fu">aes</span>(sumCPUE, <span class="at">color =</span> stationCode)) <span class="sc">+</span> </span>
<span id="cb118-2"><a href="data-exploration-and-qaqc.html#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;All Fish by Station&quot;</span>) <span class="sc">+</span> <span class="fu">theme_plots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>Here you can see that there are a lot of zeroes in the data, especially for the native fishes. This can inform the type of model you will likely use down the line (e.g. zero-inflated poisson or negative binomial modeling)</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="data-exploration-and-qaqc.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(WQ_long, <span class="fu">aes</span>(value)) <span class="sc">+</span> </span>
<span id="cb119-2"><a href="data-exploration-and-qaqc.html#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;navyblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb119-3"><a href="data-exploration-and-qaqc.html#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> <span class="fu">theme_plots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-74-1.png" width="672" />
The distributions of the water quality data are quite different, some of them being normally distributed (e.g. do, pH), some of them being right-skewed (secchi, turbidity), some being left-skewed (waterTemperature), but none being quite as skewed as the fish data.</p>
<p>When you analyze your data, you may want to transform and/or standardize some of your response or predictor variables, depending on the analysis. Transformations may help make your data normal, which would allow you to use several parametric analyses.</p>
<p>See transformed turbidity below.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="data-exploration-and-qaqc.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb120-2"><a href="data-exploration-and-qaqc.html#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(fish_WQ<span class="sc">$</span>turbidity, <span class="at">main =</span> <span class="st">&quot;Turbidity&quot;</span>)</span>
<span id="cb120-3"><a href="data-exploration-and-qaqc.html#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(fish_WQ<span class="sc">$</span>turbidity), <span class="at">main =</span> <span class="st">&quot;Log-transformed Turbidity&quot;</span>, <span class="at">col =</span> <span class="st">&quot;steelblue4&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
</div>
<div id="f-how-balanced-are-your-data" class="section level3" number="9.4.6">
<h3><span class="header-section-number">9.4.6</span> F) How balanced are your data?</h3>
<p>Often you want to have a balanced design (similar number of samples across treatments). Thus, it is useful to look at how your sample numbers are distributed across treatments.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="data-exploration-and-qaqc.html#cb121-1" aria-hidden="true" tabindex="-1"></a>fishCPUE <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="data-exploration-and-qaqc.html#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(stationCode)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   stationCode     n
##   &lt;chr&gt;       &lt;int&gt;
## 1 AL2           119
## 2 BL2           122
## 3 BL4           126
## 4 LI             28</code></pre>
<p>There is much less data in LI. You may look to see in metadata or datasheets whether this should be the case.</p>
<p>You can also look at this visually - note not all stations measured the same each year</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="data-exploration-and-qaqc.html#cb123-1" aria-hidden="true" tabindex="-1"></a>lessSta <span class="ot">&lt;-</span> fishAnnualNatives <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>stationCode <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;AL2&quot;</span>, <span class="st">&quot;AL4&quot;</span>, <span class="st">&quot;BL2&quot;</span>, <span class="st">&quot;BL4&quot;</span>))</span>
<span id="cb123-2"><a href="data-exploration-and-qaqc.html#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="data-exploration-and-qaqc.html#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lessSta, <span class="fu">aes</span>(longitude, latitude, </span>
<span id="cb123-4"><a href="data-exploration-and-qaqc.html#cb123-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size =</span> n, <span class="at">fill =</span> stationCode))<span class="sc">+</span> </span>
<span id="cb123-5"><a href="data-exploration-and-qaqc.html#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb123-6"><a href="data-exploration-and-qaqc.html#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>fWy) <span class="sc">+</span> </span>
<span id="cb123-7"><a href="data-exploration-and-qaqc.html#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>, <span class="at">discrete =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb123-8"><a href="data-exploration-and-qaqc.html#cb123-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_plots</span>(<span class="dv">90</span>)  <span class="sc">+</span></span>
<span id="cb123-9"><a href="data-exploration-and-qaqc.html#cb123-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb123-10"><a href="data-exploration-and-qaqc.html#cb123-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> T),</span>
<span id="cb123-11"><a href="data-exploration-and-qaqc.html#cb123-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
</div>
<div id="g-are-there-missing-data" class="section level3" number="9.4.7">
<h3><span class="header-section-number">9.4.7</span> G) Are there missing data?</h3>
<p>A <strong>tile</strong> plot can be useful in identifying gaps in data.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="data-exploration-and-qaqc.html#cb124-1" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> vars <span class="sc">%&gt;%</span></span>
<span id="cb124-2"><a href="data-exploration-and-qaqc.html#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(stationCode, fWy, fMonth) <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="data-exploration-and-qaqc.html#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>())</span>
<span id="cb124-4"><a href="data-exploration-and-qaqc.html#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(samples, <span class="fu">aes</span>(<span class="at">x =</span> fWy, <span class="at">y =</span> fMonth, <span class="at">fill =</span> n)) <span class="sc">+</span> <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb124-5"><a href="data-exploration-and-qaqc.html#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>stationCode) <span class="sc">+</span> <span class="fu">theme_plots</span>(<span class="dv">90</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>LI does not have data in later years, there are some missing months that might need to be checked.</p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div id="identifying-outliers" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> 5 Identifying Outliers</h2>
<p>You could spend an entire lesson on QA/QC and outlier detection. In fact we have an entire working group at DWR dedicated to providing recommendations for outlier detection.</p>
<p>I will just provide here some simple outlier tests here. I usually do a scan of the data (as in plots above), in addition to running some tests.</p>
<p>To visually identify outliers to flag I like using a combination of the package <code>plotly</code> and point plots. With plotly, you can hover over points that are questionable to get more information on that point. You can change what shows up in the hover by editing the <em>text</em> option in your ggplot() call. It is very easy to use plotly, as you can just create your plot, then use <code>ggplotly(nameofplot)</code> to turn it into an interactive plot.</p>
<p>Make normal plot.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="data-exploration-and-qaqc.html#cb125-1" aria-hidden="true" tabindex="-1"></a>(Seine_pointplots <span class="ot">&lt;-</span> WQ_long <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="data-exploration-and-qaqc.html#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> date, <span class="at">y =</span> value, </span>
<span id="cb125-3"><a href="data-exploration-and-qaqc.html#cb125-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> stationCode, </span>
<span id="cb125-4"><a href="data-exploration-and-qaqc.html#cb125-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&quot;index:&quot;</span>, index, <span class="st">&quot;samplingID:&quot;</span>, samplingId))) <span class="sc">+</span> </span>
<span id="cb125-5"><a href="data-exploration-and-qaqc.html#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb125-6"><a href="data-exploration-and-qaqc.html#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb125-7"><a href="data-exploration-and-qaqc.html#cb125-7" aria-hidden="true" tabindex="-1"></a>  viridis<span class="sc">::</span><span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span> </span>
<span id="cb125-8"><a href="data-exploration-and-qaqc.html#cb125-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_plots</span>(<span class="dv">90</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<div style="page-break-after: always;"></div>
<p>Use plotly to hover over variables (see R script)</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="data-exploration-and-qaqc.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(Seine_pointplots)</span></code></pre></div>
<p>There isn’t anything too alarming here, but you might take a look at the pH swings happening in 2012 that might indicate pH sensor malfunction. You can identify the index by hovering or filter out values that are below or above certain thresholds and check these against your initial data source</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="data-exploration-and-qaqc.html#cb127-1" aria-hidden="true" tabindex="-1"></a>pH_flagID <span class="ot">&lt;-</span> WQ_long <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="data-exploration-and-qaqc.html#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">==</span> <span class="st">&quot;pH&quot;</span> <span class="sc">&amp;</span> (value <span class="sc">&lt;</span><span class="fl">7.5</span> <span class="sc">|</span> value<span class="sc">&gt;</span><span class="fl">9.1</span>)) </span>
<span id="cb127-3"><a href="data-exploration-and-qaqc.html#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="data-exploration-and-qaqc.html#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pH_flagID)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##   date        year fWy   fMonth stationCode latitude longitude samplingId
##   &lt;date&gt;     &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;      &lt;int&gt;
## 1 2015-07-09  2015 2015  7      BL4             38.4     -122.         14
## 2 2010-01-04  2010 2010  1      LI              38.5     -122.         18
## 3 2010-04-07  2010 2010  4      LI              38.5     -122.         21
## 4 2010-09-15  2010 2010  9      BL4             38.4     -122.         28
## 5 2010-09-15  2010 2010  9      BL2             38.4     -122.         29
## 6 2010-09-30  2010 2010  9      AL2             38.5     -122.         30
## # ... with 3 more variables: parameter &lt;chr&gt;, value &lt;dbl&gt;, index &lt;int&gt;</code></pre>
<p>You can also use a Cleveland dotplot to identify the range of values and whether there are obvious outliers.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="data-exploration-and-qaqc.html#cb129-1" aria-hidden="true" tabindex="-1"></a>vars_filt<span class="sc">$</span>index <span class="ot">=</span> <span class="fu">row.names</span>(vars_filt)</span>
<span id="cb129-2"><a href="data-exploration-and-qaqc.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdotchart</span>(<span class="at">data =</span> vars_filt, </span>
<span id="cb129-3"><a href="data-exploration-and-qaqc.html#cb129-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">x=</span> <span class="st">&quot;index&quot;</span>, </span>
<span id="cb129-4"><a href="data-exploration-and-qaqc.html#cb129-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;sumCPUE&quot;</span>, </span>
<span id="cb129-5"><a href="data-exploration-and-qaqc.html#cb129-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">rotate =</span> T)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<div id="a-tukey-outliers" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> A) Tukey Outliers</h3>
<p>These are how boxplots, and also Tukey test outliers, are identified.</p>
<div class="figure">
<img src="images/eda-boxplot.png" alt="" />
<p class="caption">Boxplot outliers, from Grolemund &amp; Wickham 2017</p>
</div>
</div>
<div id="b-median-absolute-deviation-outliers" class="section level3" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> B) Median Absolute Deviation Outliers</h3>
<p>The median absolute deviation is similar to a z-score, but centering calculations around the median rather than the mean for less bias of very high or low values.</p>
<ul>
<li>d = Calculate the deviation between xi - median(x)</li>
<li>med_d = median(d)</li>
<li>mad = med_d * 1.4826</li>
<li>scores_d = d/mad</li>
<li>If scores_d &gt; 1.5, it is considered an outlier. This is similar to the number of standard deviations greater than the mean.</li>
</ul>
</div>
<div id="c-run-outlier-tests" class="section level3" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> C) Run outlier tests</h3>
<p>DWR has an Outlier Detection Working Group that has coded a few outlier tests. To install, run the code below:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="data-exploration-and-qaqc.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb130-2"><a href="data-exploration-and-qaqc.html#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="data-exploration-and-qaqc.html#cb130-3" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;ODWG/ODWGtools&quot;</span>)</span>
<span id="cb130-4"><a href="data-exploration-and-qaqc.html#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="data-exploration-and-qaqc.html#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ODWGtools)</span></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="data-exploration-and-qaqc.html#cb131-1" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> WQ_long <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="data-exploration-and-qaqc.html#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="data-exploration-and-qaqc.html#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MAD =</span> ODWGtools<span class="sc">::</span><span class="fu">outlier_mad</span>(value),</span>
<span id="cb131-4"><a href="data-exploration-and-qaqc.html#cb131-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Tukey =</span> ODWGtools<span class="sc">::</span><span class="fu">outlier_tukey</span>(value))  <span class="sc">%&gt;%</span></span>
<span id="cb131-5"><a href="data-exploration-and-qaqc.html#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MAD =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(MAD), <span class="st">&quot;not outlier&quot;</span>, <span class="fu">as.character</span>(MAD)),</span>
<span id="cb131-6"><a href="data-exploration-and-qaqc.html#cb131-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Tukey =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Tukey), <span class="st">&quot;not outlier&quot;</span>, <span class="fu">as.character</span>(Tukey)) )</span>
<span id="cb131-7"><a href="data-exploration-and-qaqc.html#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="data-exploration-and-qaqc.html#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(outliers <span class="sc">%&gt;%</span> <span class="fu">select</span>(date, value, MAD, Tukey))</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
## # Groups:   parameter [6]
##   parameter        date         value MAD         Tukey      
##   &lt;chr&gt;            &lt;date&gt;       &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      
## 1 waterTemperature 2010-07-28  27.2   not outlier not outlier
## 2 conductivity     2010-07-28 358     not outlier not outlier
## 3 do               2010-07-28   8.64  not outlier not outlier
## 4 pH               2010-07-28   8.12  not outlier not outlier
## 5 secchi           2010-07-28   0.140 not outlier not outlier
## 6 turbidity        2010-07-28  NA     not outlier not outlier</code></pre>
<p>You can use the output to decide on flags.</p>
<p>Sometimes these tests can be too sensitive, but it is a quantitative way to determine outliers.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="data-exploration-and-qaqc.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outliers) <span class="sc">+</span> </span>
<span id="cb133-2"><a href="data-exploration-and-qaqc.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value, <span class="at">color =</span> Tukey, <span class="at">shape =</span> MAD)) <span class="sc">+</span> </span>
<span id="cb133-3"><a href="data-exploration-and-qaqc.html#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb133-4"><a href="data-exploration-and-qaqc.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>(<span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span> </span>
<span id="cb133-5"><a href="data-exploration-and-qaqc.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_plots</span>(<span class="dv">90</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
</div>
<div id="d-treatment-of-outliers" class="section level3" number="9.5.4">
<h3><span class="header-section-number">9.5.4</span> D) Treatment of outliers</h3>
<p>Some options once you find outliers is to:</p>
<ul>
<li>Flag them and leave data as is (e.g. 1 = acceptable, 2 = suspicious, 3 = highly suspicious) - useful if you are providing data for others</li>
</ul>
<p>If you are analyzing data you will want to then either:</p>
<ol style="list-style-type: decimal">
<li>Remove outliers (replace with NA)</li>
<li>Replace outliers (with a mean, with data from another source, with interpolated value, with value before or after)</li>
</ol>
</div>
</div>
<div id="other-qaqc" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> 6 Other QA/QC</h2>
<p>Some other things you might want to check are:</p>
<ol style="list-style-type: decimal">
<li><p>Variable names and factor levels are consistent (sometimes there is a mis-spelling or wrong case that creates an extra level in your factor)</p></li>
<li><p>Values are within absolute ranges or thresholds (e.g. in a given system, you probably have an approximation of minimum and maximum reasonable temperatures.)</p></li>
<li><p>Check zeros to make sure they are accurate, and not defaulted for an NA or blank entry.</p></li>
</ol>
<blockquote>
<p>For outlier detection with continuous data, check out other tests in <code>ODWGTools</code>, NOAA manuals at <a href="https://ioos.noaa.gov/project/qartod/">IOOS Site</a>, or reach out to the Outlier Detection Working Group for more guidance.</p>
</blockquote>
</div>
<div id="references" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> 7 References</h2>
<ul>
<li>Grolemund, G., &amp; Wickham, H. (2017). R for Data Science. O’Reilly Media. <a href="https://r4ds.had.co.nz/index.html" class="uri">https://r4ds.had.co.nz/index.html</a></li>
<li>Interagency Ecological Program (IEP), B. Schreier, B. Davis, and N. Ikemiyagi. 2019. Interagency Ecological Program: Fish catch and water quality data from the Sacramento River floodplain and tidal slough, collected by the Yolo Bypass Fish Monitoring Program, 1998-2018. ver 2. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/b0b15aef7f3b52d2c5adc10004c05a6f" class="uri">https://doi.org/10.6073/pasta/b0b15aef7f3b52d2c5adc10004c05a6f</a> (Accessed 2022-02-28).</li>
<li>Rasmus, B. Distribution_diagrams (2018). GitHub Repository. <a href="https://github.com/rasmusab/distribution_diagrams" class="uri">https://github.com/rasmusab/distribution_diagrams</a>)</li>
<li>Qartod* Zuur A.F., Ieno E.N., Walker N.J., Saveliev A.A, Smith G.M. (2009). Mixed Effects Models and Extensions in Ecology with R.</li>
<li>Zuur A.F., Ieno E.N., Elphick C.S. (2010). A protocol for data exploration to avoid common statistical problems. Methods in Ecology and Evolution (1 (1), 3-14). <a href="https://doi.org/10.1111/j.2041-210X.2009.00001.x" class="uri">https://doi.org/10.1111/j.2041-210X.2009.00001.x</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="for-loops-and-conditionals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="basic-stats.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/09-data-exploration-qaqc.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
