--- 
title: "Coding Bookdown for EMRR"
author: "Catarina Pien"
description: |
  This book provides example code for stats and working with data in R.
  The HTML output format for this example is bookdown::gitbook,
  set in the _output.yml file.
url: https://emrr-dise.github.io/coding_bookdown/
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
cover-image: images/yolo-cows.jpg

link-citations: yes
github-repo: EMRR-DISE/coding_bookdown
---

# Preface {-}

This book provides example code for stats and working with data in R.

We start with basic R skills, plotting and manipulating data. We also have more complex code for making maps, functions, loops, then statistical tests. 

<!--chapter:end:index.Rmd-->

# Basics of R

* Creating projects, file structure
* Reading in data from csv, excel
* Reading data from online
* Writing data
* Column formats (character, numeric, datetime, factor)
* Datetimes




<!--chapter:end:01-intro.Rmd-->

# Data Manipulation

* Pivot wider and longer
* Complete cases
* Dplyr select, mutate, rename

<!--chapter:end:02-data-manipulation.Rmd-->

# Making Plots


<!--chapter:end:03-making-plots.Rmd-->

# Interactive Tools

## Plotly - Interactive plotting

```{r , warning = FALSE, message = FALSE}
library(tidyverse)
library(lubridate)
library(plotly)
```

Make a plot. 
Use plotly to make plot interactive.
```{r, warning = FALSE, message = FALSE}
iris1 <- ggplot(iris, aes(Sepal.Length, Sepal.Width, color = Species)) + geom_point()
ggplotly(iris1)
```

Changing hover text
https://plotly.com/r/hover-text-and-formatting/
https://stackoverflow.com/questions/36325154/how-to-choose-variable-to-display-in-tooltip-when-using-ggplotly

```{r, warning = FALSE, message = FALSE}
# Use label = to add extra variables in the label in addition to what's in the aes()
iris2 <- ggplot(iris, aes(Sepal.Length, Sepal.Width, color = Species, label = Petal.Length)) + geom_point()

ggplotly(iris2)


# To customize how you label text, write what you want in text = 
# <br> = line  break
iris3 <- ggplot(data = iris, aes(x = Sepal.Length, y = Sepal.Width,
                    text = paste('Name of species: ', Species,
                                 '<br>Petal length: ', Petal.Length)))+
  geom_point()


# customize whether you want to display x, y, and text, or just text
ggplotly(iris3)
ggplotly(iris3, tooltip = "text") 
ggplotly(iris3, tooltip = c("x", "text"))


# Use tooltip = NULL to get rid of all tooltip 
ggplotly(iris3, tooltip = NULL)


```

<!--chapter:end:04-interactive-tools.Rmd-->


<!--chapter:end:05-shiny.Rmd-->

# Making Maps


<!--chapter:end:06-making-maps-spatial-stats.Rmd-->

# Advanced tools

## Conditional 

## Functions

## For loops

### Apply


<!--chapter:end:07-functions-loops.Rmd-->

# Data Exploration and QA/QC

## Data Exploration

## QA/QC

<!--chapter:end:08-data-exploration-qaqc.Rmd-->

# Basic Stats

```{r}
fish_yolo_url <- "https://portal.edirepository.org/nis/dataviewer?packageid=edi.233.2&entityid=015e494911cf35c90089ced5a3127334"
fish_data <- readr::read_csv(fish_yolo_url)
str(fish_data)
fish_lmb <- fish_data %>% filter(CommonName == "Largemouth Bass")
fish_lmb2 <- fish_lmb %>% filter(MethodCode %in% c("BSEIN", "RSTR"))
```


## Parametric Stats




### T-test
```{r ttest, warning = FALSE, message = FALSE}

### 1. Independent-samples t-test: Is there a difference in LMB Count by Method? ----------------
(lmb.ttest <- t.test(fish_lmb2$Count~fish_lmb2$MethodCode)) # not significant

# Plot
ggplot(fish_lmb2, aes(x = MethodCode, y = Count)) + geom_boxplot()
ggplot(fish_lmb2, aes(x = Count, color = MethodCode)) + geom_density()
ggplot(fish_lmb, aes(x = MethodCode, y = Count)) + geom_col() # This works best for data with lots of zeros

### 2. Paired t-test: Does a treatment cause a difference? Did Action Phase alter Count of LMB? -------------
(lmb.ttest2 <- t.test(fish_lmb2$Count ~ fish_lmb2$MethodCode)) # significant

# Plot: Figure out the direction of the trend
# ggplot(fish_lmb2, aes(x = ActionPhase, y = Count)) + geom_boxplot()
# ggplot(fish_lmb2, aes(x = Count, color = ActionPhase)) + geom_density()
# ggplot(fish_lmb2, aes(x = ActionPhase, y = Count)) + geom_col() # This works best for data with lots of zeros

### 3. One-sample t-test: Is the Count greater than 0? ---------------------------------------
(lmb.ttest3 <- t.test(fish_lmb2$Count, mu = 0)) # p < 0.05, Yes, it is

```

## Non-parametric Statistics

<!--chapter:end:09-basic-stats.Rmd-->

# GLM and GLMM

<!--chapter:end:10-glm-glmm.Rmd-->

# GAM and GAMM

<!--chapter:end:11-gam-gamm.Rmd-->

# Multivariate Stats

<!--chapter:end:12-multivariate.Rmd-->

# Instructions

## About

This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports; for example, a math equation $a^2 + b^2 = c^2$.

### Usage 

Each **bookdown** chapter is an .Rmd file, and each .Rmd file can contain one (and only one) chapter. A chapter *must* start with a first-level heading: `# A good chapter`, and can contain one (and only one) first-level heading.

Use second-level and higher headings within chapters like: `## A short section` or `### An even shorter section`.

The `index.Rmd` file is required, and is also your first book chapter. It will be the homepage when you render the book.

### Render book

You can render the HTML version of this example book without changing anything:

1. Find the **Build** pane in the RStudio IDE, and

1. Click on **Build Book**, then select your output format, or select "All formats" if you'd like to use multiple formats from the same book source files.

Or build the book from the R console:

```{r, eval=FALSE}
bookdown::render_book()
```

To render this example to PDF as a `bookdown::pdf_book`, you'll need to install XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.org/tinytex/>.

### Preview book

As you work, you may start a local server to live preview this HTML book. This preview will update as you edit the book when you save individual .Rmd files. You can start the server in a work session by using the RStudio add-in "Preview book", or from the R console:

```{r eval=FALSE}
bookdown::serve_book()
```


```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```




## Introduction 

All chapters start with a first-level heading followed by your chapter title, like the line above. There should be only one first-level heading (`#`) per .Rmd file.



### A section

All chapter sections start with a second-level (`##`) or higher heading followed by your section title, like the sections above and below here. You can have as many as you want within a chapter.

#### An unnumbered section {-}

Chapters and sections are numbered by default. To un-number a heading, add a `{.unnumbered}` or the shorter `{-}` at the end of the heading, like in this section.




## Cross references and chapters

###Cross-references {#cross}

Cross-references make it easier for your readers to find and link to elements in your book.

### Chapters and sub-chapters

There are two steps to cross-reference any heading:

1. Label the heading: `# Hello world {#nice-label}`. 
    - Leave the label off if you like the automated heading generated based on your heading title: for example, `# Hello world` = `# Hello world {#hello-world}`.
    - To label an un-numbered heading, use: `# Hello world {-#nice-label}` or `{# Hello world .unnumbered}`.

1. Next, reference the labeled heading anywhere in the text using `\@ref(nice-label)`; for example, please see Chapter \@ref(cross). 
    - If you prefer text as the link instead of a numbered reference use: [any text you want can go here](#cross).

## Captioned figures and tables

Figures and tables *with captions* can also be cross-referenced from elsewhere in your book using `\@ref(fig:chunk-label)` and `\@ref(tab:chunk-label)`, respectively.

See Figure \@ref(fig:nice-fig).

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center', fig.alt='Plot with connected points showing that vapor pressure of mercury increases exponentially as temperature increases.'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Don't miss Table \@ref(tab:nice-tab).

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(pressure, 10), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```


## Parts
You can add parts to organize one or more book chapters together. Parts can be inserted at the top of an .Rmd file, before the first-level chapter heading in that same file. 

Add a numbered part: `# (PART) Act one {-}` (followed by `# A chapter`)

Add an unnumbered part: `# (PART\*) Act one {-}` (followed by `# A chapter`)

Add an appendix as a special kind of un-numbered part: `# (APPENDIX) Other stuff {-}` (followed by `# A chapter`). Chapters in an appendix are prepended with letters instead of numbers.



## Footnotes and Citations
Footnotes and citations 

### Footnotes

Footnotes are put inside the square brackets after a caret `^[]`. Like this one ^[This is a footnote.]. 

### Citations

Reference items in your bibliography file(s) using `@key`.

For example, we are using the **bookdown** package [@R-bookdown] (check out the last code chunk in index.Rmd to see how this citation key was added) in this sample book, which was built on top of R Markdown and **knitr** [@xie2015] (this citation was added manually in an external file book.bib). 
Note that the `.bib` files need to be listed in the index.Rmd with the YAML `bibliography` key.


The RStudio Visual Markdown Editor can also make it easier to insert citations: <https://rstudio.github.io/visual-markdown-editing/#/citations>



## Blocks

### Equations

Here is an equation.

\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 

You may refer to using `\@ref(eq:binom)`, like see Equation \@ref(eq:binom).


### Theorems and proofs

Labeled theorems can be referenced in text using `\@ref(thm:tri)`, for example, check out this smart theorem \@ref(thm:tri).

::: {.theorem #tri}
For a right triangle, if $c$ denotes the *length* of the hypotenuse
and $a$ and $b$ denote the lengths of the **other** two sides, we have
$$a^2 + b^2 = c^2$$
:::

Read more here <https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html>.

### Callout blocks


The R Markdown Cookbook provides more help on how to use custom blocks to design your own callouts: https://bookdown.org/yihui/rmarkdown-cookbook/custom-blocks.html

## Publishing

HTML books can be published online, see: https://bookdown.org/yihui/bookdown/publishing.html

### 404 pages

By default, users will be directed to a 404 page if they try to access a webpage that cannot be found. If you'd like to customize your 404 page instead of using the default, you may add either a `_404.Rmd` or `_404.md` file to your project root and use code and/or Markdown syntax.

### Metadata for sharing

Bookdown HTML books will provide HTML metadata for social sharing on platforms like Twitter, Facebook, and LinkedIn, using information you provide in the `index.Rmd` YAML. To setup, set the `url` for your book and the path to your `cover-image` file. Your book's `title` and `description` are also used.



This `gitbook` uses the same social sharing data across all chapters in your book- all links shared will look the same.

Specify your book's source repository on GitHub using the `edit` key under the configuration options in the `_output.yml` file, which allows users to suggest an edit by linking to a chapter's source file. 

Read more about the features of this output format here:

https://pkgs.rstudio.com/bookdown/reference/gitbook.html

Or use:

```{r eval=FALSE}
?bookdown::gitbook
```




<!--chapter:end:13-instructions.Rmd-->

`r if (knitr::is_html_output()) '
# References {-}
'`

<!--chapter:end:14-references.Rmd-->

# Time Series

<!--chapter:end:15-time-series.Rmd-->


<!--chapter:end:16-github.Rmd-->


<!--chapter:end:17-useful-resources.Rmd-->

